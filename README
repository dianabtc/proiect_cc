# ğŸŸï¸ Booking Platform - Event Hall Reservation Platform

**Cloud Computing** Project - Online reservation platform for event halls implemented with microservices architecture on Kubernetes.

---

## ğŸ“‹ Description

Web application for managing event hall reservations with role-based authentication and authorization system (USER/ADMIN).

### Business Logic

**Roles and Permissions:**
- **USER**: Creates own reservations, views only own reservations
- **ADMIN**: Manages halls (CRUD), views and cancels any reservation

**Key Features:**
1. **Hall Management** - ADMIN can create/edit/delete halls
2. **Reservations with Validation** - Automatic time conflict detection system
3. **JWT Authentication** - Secure token-based authentication
4. **Role-Based Authorization** - RBAC at endpoint level
5. **Cluster Management** - Portainer Dashboard for monitoring

---

## ğŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              NGINX Ingress Controller                â”‚
â”‚    /auth  |  /reservation  |  /dashboard            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚             â”‚              â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Auth   â”‚   â”‚Reserv.  â”‚   â”‚  Portainer    â”‚
    â”‚ Service â”‚â”€â”€â–¶â”‚ Service â”‚   â”‚  Dashboard    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚             â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
         â”‚   MySQL 8   â”‚
         â”‚  + Adminer  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Components

| **Component** | **Technology** | **Port** | **Role** |
|------------|------------|------|-----|
| **Auth Service** | FastAPI | 8000 | JWT Authentication |
| **Reservation Service** | FastAPI | 8000 | Business logic |
| **MySQL** | MySQL 8 | 3306 | Data persistence |
| **Adminer** | Adminer | 8080 | DB Admin (NodePort) |
| **Portainer** | Portainer CE | 9000 | Cluster management UI |

**ğŸ“š For detailed architecture, flows and complete explanations:** â†’ **[ARCHITECTURE.md](ARCHITECTURE.md)**

---

## ğŸš€ Quick Start

### Prerequisites

```bash
# Check required installations
docker --version          # Docker 20+
kubectl version          # Kubernetes 1.24+
helm version            # Helm 3.x
```

### Deployment

#### Method 1: Automated Script (Recommended) â­

```bash
cd helm/booking-platform
./deploy.sh
```

Script will:
- âœ… Build Docker images (optional)
- âœ… Deploy all services with Helm
- âœ… Wait for pods to be ready
- âœ… Generate Dashboard token
- âœ… Offer automatic port-forward option

#### Method 2: Manual

```bash
# 1. Build images
cd auth-service
docker build -t auth-service:latest .

cd ../reservation-service
docker build -t reservation-service:latest .

# 2. Deploy with Helm
cd ../helm/booking-platform
helm upgrade --install booking-platform . --namespace default --create-namespace

# 3. Verification
kubectl get pods
kubectl get svc
```

### Deployment Verification

```bash
# Check all resources
kubectl get pods                          # Application
kubectl get pods -n kubernetes-dashboard  # Dashboard
kubectl get pods -n monitoring            # Monitoring Stack

# Run verification script
cd helm/booking-platform
./verify-integration.sh
./verify-monitoring.sh                    # Verify Monitoring Stack
```

---

## Monitoring Stack

### Installed Components

1. **Metrics Server** - CPU/Memory metrics collection from nodes
2. **Prometheus** - Time-series database for metrics
3. **Grafana** - Metrics visualization dashboard with:
   - CPU & Memory usage (cluster and per-pod)
   - Network traffic (in/out)
   - Disk usage
   - Pod & Node count
   - System uptime

### Install Monitoring

```bash
cd helm/booking-platform

# Option 1: Automated script (Recommended)
chmod +x deploy-monitoring.sh
./deploy-monitoring.sh

# Option 2: Helm direct
helm upgrade --install booking-platform .

# Verification
./verify-monitoring.sh
```

### Access Dashboards

**Port-Forward (Local):**
```bash
# Prometheus metrics
kubectl port-forward -n monitoring svc/prometheus 9090:9090
# Visit: http://localhost:9090

# Grafana visualization
kubectl port-forward -n monitoring svc/grafana 3000:3000
# Visit: http://localhost:3000
# Login: admin / admin123
```

**NodePort (From network):**
```
Prometheus: http://<node-ip>:30909
Grafana:    http://<node-ip>:30300
```

### Application Services Monitoring

To add Prometheus metrics to FastAPI services:

```bash
# 1. Update dependencies
echo "prometheus-client==0.19.0" >> auth-service/requirements.txt
echo "prometheus-fastapi-instrumentator==6.1.0" >> auth-service/requirements.txt

# 2. Rebuild images and deploy
docker build -t auth-service:latest ./auth-service
docker build -t reservation-service:latest ./reservation-service
helm upgrade booking-platform . 

# 3. Enable monitoring
./enable-app-monitoring.sh
```

See [LAB5_MONITORING.md](LAB5_MONITORING.md) and [PROMETHEUS_INTEGRATION.md](PROMETHEUS_INTEGRATION.md)

---

## ğŸŒ Access Services

### API Services

```bash
# Register user
curl -X POST http://localhost/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username": "test", "password": "test123"}'

# Login (get JWT token)
curl -X POST http://localhost/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "test", "password": "test123"}'
# Response: {"access_token": "eyJ..."}

# List halls (public)
curl http://localhost/reservation/halls

# Create reservation (authenticated)
curl -X POST http://localhost/reservation/reservations \
  -H "Authorization: Bearer <JWT_TOKEN>" \
  -H "Content-Type: application/json" \
  -d '{
    "hall_id": 1,
    "date": "2026-01-25",
    "start_time": "14:00",
    "end_time": "16:00"
  }'
```

### Portainer Dashboard ğŸ“Š

**Dashboard provides complete cluster visualization:**

```bash
# Option 1: Use minikube service (Recommended)
minikube service portainer -n kubernetes-dashboard
# Will automatically open browser with correct URL

# Option 2: Port forward (local access)
kubectl port-forward -n kubernetes-dashboard svc/portainer 9000:9000
# Then access: http://localhost:9000
```

**First-time setup:**
- Create admin user (username + password)
- Select "Local" environment
- Click "Connect"

**What you can do in Portainer:**
- âœ… View all pods, deployments, services from all namespaces
- âœ… Monitor status and resource usage
- âœ… Access logs from any container
- âœ… Exec into containers (interactive terminal)
- âœ… Manage volumes (mysql-pvc, portainer-data)
- âœ… Deploy new applications from templates
- âœ… Visualize images, networks, stacks

---

## ğŸ“ Project Structure

```
proiect_cc/
â”œâ”€â”€ auth-service/              # Authentication microservice
â”‚   â”œâ”€â”€ app/                   # FastAPI code
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ requirements.txt
â”‚
â”œâ”€â”€ reservation-service/       # Reservation microservice
â”‚   â”œâ”€â”€ app/                   # FastAPI code
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ requirements.txt
â”‚
â”œâ”€â”€ helm/booking-platform/     # Helm chart
â”‚   â”œâ”€â”€ Chart.yaml
â”‚   â”œâ”€â”€ values.yaml           # Central configuration
â”‚   â”œâ”€â”€ deploy.sh             # Deployment script
â”‚   â”œâ”€â”€ verify-integration.sh # Verification script
â”‚   â””â”€â”€ templates/
â”‚       â”œâ”€â”€ auth/             # Auth K8s manifests
â”‚       â”œâ”€â”€ reservation/      # Reservation K8s manifests
â”‚       â”œâ”€â”€ mysql/            # MySQL K8s manifests
â”‚       â”œâ”€â”€ adminer/          # Adminer K8s manifests
â”‚       â”œâ”€â”€ dashboard/        # Dashboard K8s manifests (10 files)
â”‚       â””â”€â”€ ingress.yaml      # External routing
â”‚
â”œâ”€â”€ README.md                 # This file
â””â”€â”€ ARCHITECTURE.md          # ğŸ“š Complete technical documentation
```

---

## ğŸ”‘ API Endpoints

### Auth Service (`/auth`)

| Method | Endpoint | Description | Auth |
|--------|----------|-------------|------|
| POST | `/auth/register` | Register new user | - |
| POST | `/auth/login` | Login, returns JWT token | - |
| GET | `/auth/validate` | Token validation (inter-service) | Bearer |

### Reservation Service (`/reservation`)

| Method | Endpoint | Description | Auth | Role |
|--------|----------|-------------|------|------|
| GET | `/reservation/halls` | List halls | - | PUBLIC |
| POST | `/reservation/halls` | Create hall | Bearer | ADMIN |
| PATCH | `/reservation/halls/{id}` | Edit hall | Bearer | ADMIN |
| DELETE | `/reservation/halls/{id}` | Delete hall | Bearer | ADMIN |
| GET | `/reservation/availability` | Check availability | - | PUBLIC |
| POST | `/reservation/reservations` | Create reservation | Bearer | USER |
| GET | `/reservation/reservations` | List reservations (own/all) | Bearer | USER/ADMIN |
| POST | `/reservation/reservations/{id}/cancel` | Cancel reservation | Bearer | USER/ADMIN |

---

## ğŸ› ï¸ Configuration and Management

### Environment Variables

Configured in `values.yaml`:

```yaml
auth:
  env:
    databaseUrl: mysql+pymysql://root:password@mysql:3306/auth_db

reservation:
  env:
    databaseUrl: mysql+pymysql://root:password@mysql:3306/reservation_db
    authServiceUrl: http://auth-service:8000/auth

dashboard:
  service:
    type: ClusterIP  # Or NodePort for direct access
    port: 9000
```

### Scaling

```bash
# Scale at deployment level
kubectl scale deployment auth-service --replicas=3

# Or modify in values.yaml and upgrade
helm upgrade booking-platform . --set auth.replicaCount=3
```

### Logs and Monitoring

```bash
# Logs from services
kubectl logs -f deployment/auth-service
kubectl logs -f deployment/reservation-service

# Dashboard logs
kubectl logs -f -n kubernetes-dashboard deployment/portainer

# Events (debugging)
kubectl get events --sort-by='.lastTimestamp'

# Resource usage
kubectl top nodes
kubectl top pods
```

---

## ğŸ› Troubleshooting

### Common Issues

**Pods not starting:**
```bash
kubectl describe pod <pod-name>
kubectl logs <pod-name>
```

**Database connection failed:**
```bash
kubectl logs deployment/mysql
kubectl exec -it deployment/mysql -- mysql -u root -ppassword -e "SHOW DATABASES;"
```

**Ingress not working:**
```bash
kubectl get ingress -A
kubectl describe ingress booking-ingress

# Enable Ingress in minikube
minikube addons enable ingress
```

**Dashboard token expired:**
```bash
# Regenerate access to Portainer (if needed)
kubectl port-forward -n kubernetes-dashboard svc/portainer 9000:9000
```

**ğŸ“š For detailed troubleshooting:** â†’ **[ARCHITECTURE.md](ARCHITECTURE.md#troubleshooting)**

---

## ğŸ”’ Security

### Implemented Security Measures

- âœ… **Password Hashing**: bcrypt for passwords
- âœ… **JWT Authentication**: Token-based auth with expiration
- âœ… **RBAC**: Role-Based Access Control at endpoint level
- âœ… **Kubernetes RBAC**: ServiceAccounts with limited permissions
- âœ… **HTTPS**: Dashboard uses HTTPS with self-signed certificate
- âœ… **Token Expiration**: JWT tokens expire after 24h

### âš ï¸ For Production

```bash
# 1. Change MySQL credentials
kubectl create secret generic mysql-credentials \
  --from-literal=root-password=$(openssl rand -base64 20)

# 2. Use Secrets for JWT
kubectl create secret generic jwt-secret \
  --from-literal=key=$(openssl rand -base64 32)

# 3. Configure TLS for Ingress
# 4. Limit RBAC permissions for Dashboard
# 5. Enable Network Policies
```

---

## ğŸ“Š Project Features

### âœ… Implemented

- [x] Microservices Architecture
- [x] Containerization with Docker
- [x] Orchestration with Kubernetes
- [x] Helm Charts for deployment
- [x] JWT Authentication
- [x] Role-Based Access Control (RBAC)
- [x] Database Persistence (MySQL + PVC)
- [x] Ingress Routing (NGINX)
- [x] **Portainer Dashboard** - Graphical utility microservice
- [x] Metrics Scraper for Dashboard
- [x] Health Checks for all services
- [x] DB Admin UI (Adminer)
- [x] Complete documentation

### ğŸ¯ Demonstrates

- Cloud-Native architecture
- Automatic Service Discovery
- Horizontal scaling ready
- Persistent storage
- Secret management
- Infrastructure as Code (IaC)
- Observability and monitoring

---

## ğŸ“š Complete Documentation

### **[â†’ ARCHITECTURE.md](ARCHITECTURE.md)** 

Complete technical documentation with:
- ğŸ“ **Detailed architecture** with diagrams
- ğŸ”„ **Data flows** for each operation
- ğŸŒ **Networking** and inter-service communication
- ğŸ” **Security** and detailed RBAC
- ğŸš€ **Deployment guide** step by step
- ğŸ› **Complete troubleshooting**
- ğŸ“Š **Kubernetes Dashboard** - complete explanations

### Available Scripts

```bash
# Complete automated deployment
./helm/booking-platform/deploy.sh

# Integration verification
./helm/booking-platform/verify-integration.sh
```

---

## ğŸ“ Demo Use Cases

**1. Cloud-Native Architecture:**
- "The application uses 4 independent microservices..."
- Show in Dashboard: visual deployments

**2. Horizontal Scaling:**
- "We can scale instantly with one click..."
- Demo: Scale auth-service 1â†’3 replicas in Dashboard

**3. Real-time Monitoring:**
- "We monitor resources and logs in real-time..."
- Demo: View live logs from reservation-service

**4. High Availability:**
- "Kubernetes ensures self-healing..."
- Demo: Delete pod â†’ K8s recreates automatically

**5. Persistent Data:**
- "Data survives restarts..."
- Demo: Show PVC bound in Dashboard

---

## ğŸ¤ Technologies Used

| Category | Technology | Version |
|-----------|------------|----------|
| **Backend** | FastAPI | 0.110.0 |
| **Database** | MySQL | 8.0 |
| **ORM** | SQLAlchemy | 2.0 |
| **Auth** | JWT (PyJWT) | - |
| **Container** | Docker | - |
| **Orchestration** | Kubernetes | 1.24+ |
| **Package Mgmt** | Helm | 3.x |
| **Ingress** | NGINX Ingress Controller | - |
| **Management** | Portainer CE | latest |
| **DB Admin** | Adminer | latest |
| **Monitoring** | Prometheus + Grafana | - |

---

## ğŸ“ License

Academic project - Cloud Computing 2026

---

## ğŸ“ Contact & Support

For questions about architecture, deployment or functionality, consult **[ARCHITECTURE.md](ARCHITECTURE.md)**.

---

**â­ Fully functional and production-ready project with Portainer Dashboard for cluster management!** ğŸš€

**ğŸ¯ All project requirements met:**
- âœ… Independent microservices
- âœ… Containerization
- âœ… Kubernetes orchestration
- âœ… Persistent storage
- âœ… **Graphical utility microservice (Dashboard)**
- âœ… Complete documentation
